{"componentChunkName":"component---src-templates-post-js-content-file-path-home-runner-work-varya-github-com-varya-github-com-content-posts-fonts-no-cramp-index-en-md","path":"/en/posts/fonts-no-cramp/","result":{"data":{"mdx":{"id":"82775465-fb04-52d9-bf37-e961cb82ae60","body":"\nA developer using custom fonts in web (don't say this is evil) usually face a\ndilemma.\n\nThe users' main interest is the content of the page not the\nview. It is nice to provide it as fast as possible and then apply a custom font.\nThis blog used to work this way. I provided a script among others in the bundle\nlinked by the end of the page.\n<excerpt/>\n\n```js\n(function (d) {\n  function addFont(url, h, l) {\n    h = d.getElementsByTagName(\"head\")[0];\n    l = d.createElement(\"link\");\n    l.href = url;\n    l.rel = \"stylesheet\";\n    h.appendChild(l);\n  }\n\n  addFont(\n    \"//fonts.googleapis.com/css?\" +\n      \"family=Noto+Serif&subset=latin,cyrillic-ext,cyrillic\"\n  );\n})(document);\n```\n\nThe drawback is obvious. Once a font is loaded and apllied, a user notice\ntwitching as a page is being re-rendering. It is recommended to define a\nsuitable system font in the `font-face`. But there never is a good fit.\nOtherwise there was no need in a custom font.\n\nThe only way to avoid the font rendering jerk is to provide the font in advance.\nWith inlining a base64 of a font into CSS and linking it in `<head>` no\ntwitching is guaranteed as well as increasing page loading time.\n\nFor a while I was deciding between the two variants until my colleague [Roman\nKomarov aka kizu](http://kizu.ru/en/) suggested an elegant solution which is in\nuse right now.\n\nAt the first time a user opens any page of this site, a CSS with the font is\nloaded and stored as a piece of text in the `localStorage`.\n\n```js\n$(function () {\n  if (typeof Storage === \"undefined\") {\n    return;\n  }\n  if (localStorage.getItem(\"varya.me.fonts\") === null) {\n    $.ajax({\n      url: \"../../data/fonts.css\",\n      success: function (response) {\n        localStorage.setItem(\"varya.me.fonts\", response);\n      },\n      dataType: \"text\",\n    });\n  }\n});\n```\n\nBut I do not apply this CSS after loading. So, not jerks. As request is only to\nfill up the storage, it goes after the `domReady`.\n\nBy the time of requesting the next page the custom font is already in the user's\ncomputer. Checking that it is available I apply it to the page. The faster the\nbetter, and as the action costs almost nothing an inline `<head>` script goes\nhere.\n\n```js\n(function (d, s, l, r) {\n  if (typeof s !== \"undefined\" && l.getItem(\"varya.me.fonts\")) {\n    r = [\"<style>\", l.getItem(\"varya.me.fonts\"), \"</style>\"];\n    document.write(r.join(\"\"));\n  }\n})(document, Storage, localStorage);\n```\n\nWith that the blog looks as it should do with 2+ pages loaded. I consider this\nprice for no-twitching custom font as reasonable.\n\nAny ideas of making it even better?\n","fields":{"slug":"en/posts/fonts-no-cramp/","disqusIdentifier":"en-issues-fonts-no-cramp","readingTime":{"minutes":2.025}},"frontmatter":{"title":"Custom fonts with no cramp","subTitle":null,"date":"26 November 2013","v2":null,"old":true,"tumblr":null,"tags":null,"meta":null,"canonical":null,"cover":null}},"site":{"siteMetadata":{"siteUrl":"https://varya.me"}}},"pageContext":{"slug":"en/posts/fonts-no-cramp/","prev":{"id":"d2181af1-0827-5d41-a264-9590988575e3","fields":{"slug":"en/posts/best-way-to-hide/","disqusIdentifier":"en-issues-best-way-to-hide","level":1,"fileRelativePath":"best-way-to-hide/index_en.md","lang":"en","readingTime":{"minutes":2.63}},"frontmatter":{"title":"The Best Way to Hide","subTitle":null,"link":null,"v2":null,"old":true,"date":"2013-10-31T00:00:00.000Z","layout":"post","tags":null},"internal":{"contentFilePath":"/home/runner/work/varya.github.com/varya.github.com/content/posts/best-way-to-hide/index_en.md"}},"next":{"id":"0d2c810d-5300-5495-b0df-a1c8ad703156","fields":{"slug":"en/posts/blocks-and-bundles/","disqusIdentifier":"en-issues-blocks-and-bundles","level":1,"fileRelativePath":"blocks-and-bundles/index_en.md","lang":"en","readingTime":{"minutes":4.095}},"frontmatter":{"title":"Blocks are bricks, and bundles are buildings","subTitle":null,"link":null,"v2":null,"old":true,"date":"2014-01-06T00:00:00.000Z","layout":"post","tags":null},"internal":{"contentFilePath":"/home/runner/work/varya.github.com/varya.github.com/content/posts/blocks-and-bundles/index_en.md"}},"fileSourceUrl":"https://github.com/varya/varya.github.com/edit/develop/content/posts/fonts-no-cramp/index_en.md","frontmatter":{"title":"Custom fonts with no cramp","categories":"en issues","old":true,"date":"2013-11-26T00:00:00.000Z","layout":"post"}}},"staticQueryHashes":[],"slicesMap":{}}